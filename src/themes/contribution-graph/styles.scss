/**
 * Contribution Graph theme styles
 * GitHub-style grid with pixel-art digits
 */

// =============================================================================
// COLOR MODE PALETTES
// =============================================================================

:root {
  // Dark mode palette (matches legacy contribution-graph)
  --contribution-graph-background-for-dark: #0d1117;
  --contribution-graph-square-0-for-dark: #161b22;
  --contribution-graph-square-1-for-dark: #0e4429;
  --contribution-graph-square-2-for-dark: #006d32;
  --contribution-graph-square-3-for-dark: #26a641;
  --contribution-graph-square-4-for-dark: #39d353;
  --contribution-graph-digit-for-dark: #39d353;

  // Light mode palette (matches legacy contribution-graph)
  --contribution-graph-background-for-light: #ffffff;
  --contribution-graph-square-0-for-light: #f9fafb;
  --contribution-graph-square-1-for-light: #9be9a8;
  --contribution-graph-square-2-for-light: #40c463;
  --contribution-graph-square-3-for-light: #30a14e;
  --contribution-graph-square-4-for-light: #216e39;
  --contribution-graph-digit-for-light: #166534;
}

// =============================================================================
// COLOR MODE SWITCHING
// =============================================================================

@media (prefers-color-scheme: dark) {
  :root {
    --contribution-graph-background: var(--contribution-graph-background-for-dark);
    --contribution-graph-square-0: var(--contribution-graph-square-0-for-dark);
    --contribution-graph-square-1: var(--contribution-graph-square-1-for-dark);
    --contribution-graph-square-2: var(--contribution-graph-square-2-for-dark);
    --contribution-graph-square-3: var(--contribution-graph-square-3-for-dark);
    --contribution-graph-square-4: var(--contribution-graph-square-4-for-dark);
    --contribution-graph-digit: var(--contribution-graph-digit-for-dark);
    --contribution-graph-pulse-animation: contribution-graph-pulse-dark;
  }
}

@media (prefers-color-scheme: light) {
  :root {
    --contribution-graph-background: var(--contribution-graph-background-for-light);
    --contribution-graph-square-0: var(--contribution-graph-square-0-for-light);
    --contribution-graph-square-1: var(--contribution-graph-square-1-for-light);
    --contribution-graph-square-2: var(--contribution-graph-square-2-for-light);
    --contribution-graph-square-3: var(--contribution-graph-square-3-for-light);
    --contribution-graph-square-4: var(--contribution-graph-square-4-for-light);
    --contribution-graph-digit: var(--contribution-graph-digit-for-light);
    --contribution-graph-pulse-animation: contribution-graph-pulse-light;
  }
}

[data-color-mode='dark'] {
  --contribution-graph-background: var(--contribution-graph-background-for-dark);
  --contribution-graph-square-0: var(--contribution-graph-square-0-for-dark);
  --contribution-graph-square-1: var(--contribution-graph-square-1-for-dark);
  --contribution-graph-square-2: var(--contribution-graph-square-2-for-dark);
  --contribution-graph-square-3: var(--contribution-graph-square-3-for-dark);
  --contribution-graph-square-4: var(--contribution-graph-square-4-for-dark);
  --contribution-graph-digit: var(--contribution-graph-digit-for-dark);
  --contribution-graph-pulse-animation: contribution-graph-pulse-dark;
}

[data-color-mode='light'] {
  --contribution-graph-background: var(--contribution-graph-background-for-light);
  --contribution-graph-square-0: var(--contribution-graph-square-0-for-light);
  --contribution-graph-square-1: var(--contribution-graph-square-1-for-light);
  --contribution-graph-square-2: var(--contribution-graph-square-2-for-light);
  --contribution-graph-square-3: var(--contribution-graph-square-3-for-light);
  --contribution-graph-square-4: var(--contribution-graph-square-4-for-light);
  --contribution-graph-digit: var(--contribution-graph-digit-for-light);
  --contribution-graph-pulse-animation: contribution-graph-pulse-light;
}

// =============================================================================
// THEME STYLES
// =============================================================================

// Theme container - background applied to orchestrator-provided container
// Base positioning (fixed, inset, flex, centering) comes from [data-theme] in app-shell.css
[data-theme="contribution-graph"] {
  background: var(--contribution-graph-background);
}

// Landing page background - same grid as time page for visual consistency
// NOTE: Theme switching (CSS variable changes) is instant by default - no transition block needed
// IMPORTANT: Use position: fixed (not absolute) so background is positioned relative to viewport,
// not the scrollable landing-page container. This prevents nested scrolling issues.
// The grid is sized to document.scrollHeight via JS, ensuring it fills the entire scrollable area.
.landing-theme-background--contribution-graph {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100vh;
  overflow: visible;
  background: var(--contribution-graph-background);
  
  // Grid positioned at top-left, sized to fill scrollable area via JS
  .contribution-graph-grid {
    position: absolute;
    top: 0;
    left: 0;
  }
}

.contribution-graph-grid {
  // Grid is centered via flexbox parent
  // Use class-based visibility instead of inline style to preserve layout properties
  // PERF: Container-level containment allows browser to skip sibling recalc
  contain: layout style paint;

  // Dynamic grid layout via CSS custom properties (set by JS)
  display: grid;
  grid-template-columns: repeat(var(--contribution-graph-cols), var(--contribution-graph-square-size));
  grid-template-rows: repeat(var(--contribution-graph-rows), var(--contribution-graph-square-size));
  gap: var(--contribution-graph-gap);
  width: var(--contribution-graph-grid-width);
  height: var(--contribution-graph-grid-height);
}

// =============================================================================
// SQUARE STYLES
// =============================================================================

.contribution-graph-square {
  // PERF: Full containment per square - tells browser layout/paint changes
  // inside don't affect siblings. Essential for 5000+ element grids.
  contain: strict;
  // Size and border-radius via CSS custom properties (set by JS on grid)
  width: var(--contribution-graph-square-size);
  height: var(--contribution-graph-square-size);
  border-radius: var(--contribution-graph-border-radius);
  // No base transition - instant color changes like legacy theme
  // Transitions only applied via specific classes (ambient-fade)
}

.contribution-graph-square.intensity-0 {
  background-color: var(--contribution-graph-square-0);
}

.contribution-graph-square.intensity-1 {
  background-color: var(--contribution-graph-square-1);
}

.contribution-graph-square.intensity-2 {
  background-color: var(--contribution-graph-square-2);
}

.contribution-graph-square.intensity-3 {
  background-color: var(--contribution-graph-square-3);
}

.contribution-graph-square.intensity-4 {
  background-color: var(--contribution-graph-square-4);
}

// Digit squares - highest intensity with drop shadow (matches legacy)
.contribution-graph-square.is-digit {
  background-color: var(--contribution-graph-digit);
  filter: drop-shadow(0 1px 2px rgb(0 0 0 / 20%));
}

// =============================================================================
// HOVER EFFECT - "Surprise and delight" for lit squares
// PERF: transform is compositor-only (GPU-accelerated), no paint triggered
// =============================================================================

// Only apply hover effect to "lit" squares (non-empty)
.contribution-graph-square.intensity-1:hover,
.contribution-graph-square.intensity-2:hover,
.contribution-graph-square.intensity-3:hover,
.contribution-graph-square.intensity-4:hover,
.contribution-graph-square.is-digit:hover,
.contribution-graph-square.is-wall:hover,
.contribution-graph-square.is-message:hover,
.contribution-graph-square.is-ambient:hover {
  transform: scale(1.15);
  z-index: 10;
}

// Disable hover effect when reduced motion is preferred
@media (prefers-reduced-motion: reduce) {
  .contribution-graph-square:hover {
    transform: none;
  }
}

// =============================================================================
// AMBIENT ACTIVITY - CSS-Driven Animation Lifecycle
// =============================================================================

// Ambient squares use CSS animations for the full lifecycle:
// fade-in → hold → fade-out, all handled by CSS with no JS timing overhead.
// Different intensity levels have different durations for visual variety.
// JS only adds/removes the `is-ambient` class; CSS handles all timing.

// Base ambient class triggers the animation
// Phase determines timing multiplier, intensity determines color and base duration
.contribution-graph-square.is-ambient {
  animation: contribution-graph-ambient calc(var(--ambient-base-duration, 2.5s) * var(--phase-multiplier, 1)) ease-in-out forwards;
}

// Phase-based timing multipliers:
// Calm = slow, breathing effect; Final = rapid, exciting effect
.contribution-graph-square.is-ambient.phase-calm {
  --phase-multiplier: 1.8;
}

.contribution-graph-square.is-ambient.phase-building {
  --phase-multiplier: 1.3;
}

.contribution-graph-square.is-ambient.phase-intense {
  --phase-multiplier: 1.0;
}

.contribution-graph-square.is-ambient.phase-final {
  --phase-multiplier: 0.7;
}

// Intensity determines target color and base animation duration
// Lower intensities = longer, subtler pulses; higher = shorter, brighter
.contribution-graph-square.is-ambient.intensity-1 {
  --ambient-target: var(--contribution-graph-square-1);
  --ambient-base-duration: 3.2s;
}

.contribution-graph-square.is-ambient.intensity-2 {
  --ambient-target: var(--contribution-graph-square-2);
  --ambient-base-duration: 2.6s;
}

.contribution-graph-square.is-ambient.intensity-3 {
  --ambient-target: var(--contribution-graph-square-3);
  --ambient-base-duration: 2.0s;
}

.contribution-graph-square.is-ambient.intensity-4 {
  --ambient-target: var(--contribution-graph-square-4);
  --ambient-base-duration: 1.6s;
}

// Animation keyframes: fade-in → hold → fade-out
// Uses CSS variables for colors, returns to base at 100%
// animation-fill-mode: forwards keeps it at base color after completion
@keyframes contribution-graph-ambient {
  0% {
    background-color: var(--contribution-graph-square-0);
  }
  12% {
    background-color: var(--ambient-target, var(--contribution-graph-square-2));
  }
  75% {
    background-color: var(--ambient-target, var(--contribution-graph-square-2));
  }
  100% {
    background-color: var(--contribution-graph-square-0);
  }
}

// Reduced motion: no animation, just brief color change
@media (prefers-reduced-motion: reduce) {
  .contribution-graph-square.is-ambient {
    animation: none;
    // Show intensity color briefly, JS will remove class on next tick
    background-color: var(--ambient-target, var(--contribution-graph-square-2));
  }
}

// =============================================================================
// PULSE ANIMATION (matches legacy contribution-graph)
// =============================================================================

// Dark mode pulse - fade lighter (reduce opacity to 70%)
@keyframes contribution-graph-pulse-dark {
  0%, 100% { opacity: 100%; }
  50% { opacity: 70%; }
}

// Light mode pulse - subtle fade for dark green digits (82% opacity)
@keyframes contribution-graph-pulse-light {
  0%, 100% { opacity: 100%; }
  50% { opacity: 82%; }
}

.contribution-graph-square.pulse-digit {
  animation: var(--contribution-graph-pulse-animation, contribution-graph-pulse-dark) 1.2s ease-in-out infinite;
}

// Reduced motion: disable pulse animation
@media (prefers-reduced-motion: reduce) {
  .contribution-graph-square.pulse-digit {
    animation: none;
  }
}

// =============================================================================
// WALL BUILD ANIMATION
// =============================================================================

// Wall squares - solid color, takes precedence over ALL other states
// This allows digits and ambient to keep showing but wall visually "covers" them
// Animated via RAF batching in JS for consistent cross-device performance
.contribution-graph-square.is-wall {
  background-color: var(--contribution-graph-digit) !important;
  // Override pulse animation
  animation: none !important;
}

// Message squares (pixel art text) - stay visible during and after unbuild
// Also takes precedence over ambient
.contribution-graph-square.is-message {
  background-color: var(--contribution-graph-digit) !important;
  filter: drop-shadow(0 1px 2px rgb(0 0 0 / 20%));
  animation: var(--contribution-graph-pulse-animation, contribution-graph-pulse-dark) 1.2s ease-in-out infinite;
}

// =============================================================================
// SHADOW OVERLAY (solar helper)
// =============================================================================

.cg-shadow-overlay {
  position: absolute;
  top: 16px;
  left: 16px;
  padding: 12px;
  border-radius: 8px;
  background: color-mix(in srgb, var(--contribution-graph-background) 92%, #000 8%);
  color: var(--contribution-graph-square-4);
  box-shadow: 0 10px 30px rgb(0 0 0 / 25%);
  width: clamp(240px, 24vw, 320px);
  border: 1px solid color-mix(in srgb, var(--contribution-graph-digit) 30%, transparent);
  display: grid;
  gap: 8px;
  z-index: 5;
}

.cg-shadow-title {
  font-weight: 700;
  letter-spacing: 0.01em;
}

.cg-shadow-form {
  display: grid;
  gap: 4px;
}

.cg-shadow-label {
  font-size: 12px;
  color: var(--contribution-graph-square-3);
}

.cg-shadow-input {
  width: 100%;
  padding: 6px 8px;
  border-radius: 6px;
  border: 1px solid color-mix(in srgb, var(--contribution-graph-digit) 40%, transparent);
  background: color-mix(in srgb, var(--contribution-graph-background) 90%, #000 10%);
  color: inherit;
}

.cg-shadow-input:focus {
  outline: 2px solid var(--contribution-graph-digit);
  outline-offset: 1px;
}

.cg-shadow-status {
  font-size: 12px;
  color: var(--contribution-graph-square-3);
}

.cg-shadow-results {
  display: grid;
  gap: 4px;
  font-size: 13px;
}

.cg-shadow-metric {
  display: flex;
  justify-content: space-between;
  gap: 12px;
}

.cg-shadow-visual {
  position: relative;
  height: 120px;
  background: color-mix(in srgb, var(--contribution-graph-background) 80%, #000 20%);
  border-radius: 6px;
  overflow: hidden;
}

.cg-shadow-ground {
  position: absolute;
  bottom: 18px;
  left: 0;
  right: 0;
  height: 2px;
  background: color-mix(in srgb, var(--contribution-graph-digit) 50%, transparent);
}

.cg-shadow-object {
  position: absolute;
  bottom: 20px;
  left: 30px;
  width: 14px;
  height: 60px; /* constant base; scaled via transform to show ratio only */
  background: var(--contribution-graph-digit);
  border-radius: 3px 3px 0 0;
  box-shadow: 0 2px 6px rgb(0 0 0 / 25%);
  transform-origin: bottom center;
  transform: scaleY(var(--cg-object-scale, 1));
}

.cg-shadow-shadow {
  position: absolute;
  bottom: 18px;
  left: 44px;
  height: 6px;
  width: var(--cg-shadow-length, 100px);
  background: color-mix(in srgb, var(--contribution-graph-square-4) 55%, transparent);
  border-radius: 4px;
  box-shadow: 0 1px 4px rgb(0 0 0 / 18%);
}

.cg-shadow-shadow.is-hidden {
  opacity: 0.35;
  width: 30px;
}

@media (max-width: 640px) {
  .cg-shadow-overlay {
    width: calc(100% - 24px);
    left: 12px;
    right: 12px;
    top: 12px;
  }
}

/* Size meter and scale (reference-based) */
.cg-size-meter {
  margin-top: 8px;
  display: grid;
  gap: 6px;
}

.cg-size-meter-bar {
  height: 8px;
  width: 0%;
  border-radius: 999px;
  background: linear-gradient(90deg,
    color-mix(in srgb, var(--contribution-graph-square-3) 70%, transparent) 0%,
    var(--contribution-graph-digit) 100%);
  box-shadow: 0 1px 3px rgb(0 0 0 / 20%);
  transition: width 200ms ease;
}

@media (prefers-reduced-motion: reduce) {
  .cg-size-meter-bar {
    transition: none;
  }
}

.cg-size-meter-label {
  font-size: 12px;
  color: var(--contribution-graph-square-3);
}

.cg-shadow-scale {
  position: absolute;
  left: 16px;
  bottom: 18px;
  height: 80px;
  width: 30px;
}

.cg-scale-track {
  position: absolute;
  left: 14px;
  bottom: 0;
  top: 0;
  width: 2px;
  background: color-mix(in srgb, var(--contribution-graph-square-4) 35%, transparent);
}

.cg-scale-tick {
  position: absolute;
  left: 0;
  transform: translateY(50%);
  font-size: 10px;
  color: var(--contribution-graph-square-3);
}

.cg-scale-tick[data-tick="0.5"] { bottom: calc(60px * 0.5); }
.cg-scale-tick[data-tick="1"]   { bottom: 60px; }
.cg-scale-tick[data-tick="2"]   { bottom: calc(60px * 2); }


