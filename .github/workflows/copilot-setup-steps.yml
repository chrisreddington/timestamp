# GitHub Copilot Setup Steps Workflow
# Defines the environment setup steps that GitHub Copilot uses when working on this repository
# This runs before Copilot starts working, giving it the tools needed to build, test, and run the project
# Learn more: https://docs.github.com/en/copilot/how-tos/use-copilot-agents/coding-agent/customize-the-agent-environment
#
# IMPORTANT: The job name 'copilot-setup-steps' is required for GitHub Copilot to recognize this workflow
name: "Copilot Setup Steps"

# Trigger conditions:
# - workflow_dispatch: Allows manual triggering from the Actions tab
# - push/pull_request on workflow file: Validates the workflow configuration
# Documentation: https://docs.github.com/en/actions/writing-workflows/choosing-when-your-workflow-runs/events-that-trigger-workflows
on:
  workflow_dispatch:
  push:
    paths: [.github/workflows/copilot-setup-steps.yml]
  pull_request:
    paths: [.github/workflows/copilot-setup-steps.yml]

# Minimal permissions: only read access needed for setup validation
# Learn more: https://docs.github.com/en/actions/security-for-github-actions/security-guides/automatic-token-authentication#permissions-for-the-github_token
permissions:
  contents: read

jobs:
  # CRITICAL: This job name must be exactly 'copilot-setup-steps' for GitHub Copilot to recognize it
  # Copilot uses these steps to understand the project's development environment
  copilot-setup-steps:
    runs-on: ubuntu-latest
    permissions:
      contents: read
    steps:
      # Step 1: Checkout the repository
      # Pinned to full commit SHA for security best practices
      # Learn more: https://docs.github.com/en/actions/security-for-github-actions/security-guides/security-hardening-for-github-actions#using-third-party-actions
      - name: Checkout
        uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8 # v6.0.1

      # Step 2: Setup Node.js environment
      # Uses .node-version file to ensure consistent Node.js version across environments
      # Caches npm dependencies for faster subsequent runs
      - name: Setup Node
        uses: actions/setup-node@6044e13b5dc448c55e2357c09f80417699197238 # v6.2.0
        with:
          node-version-file: '.node-version'
          cache: 'npm'

      # Step 3: Install project dependencies
      # Using 'npm ci' (clean install) ensures reproducible builds from package-lock.json
      # This is faster and more reliable than 'npm install' in CI environments
      # Documentation: https://docs.npmjs.com/cli/v10/commands/npm-ci
      - name: Install dependencies
        run: npm ci

      # Step 4: Install Playwright browsers with system dependencies
      # NOTE: Caching Playwright browsers is NOT recommended by Playwright docs
      # The time to restore cache is comparable to downloading, and system deps
      # (installed by --with-deps) cannot be cached, making caching ineffective.
      # Learn more: https://playwright.dev/docs/ci#caching-browsers
      # Only installs Chromium to minimize CI time (we don't need all browsers for setup validation)
      # --with-deps ensures all required system libraries are installed
      - name: Install Playwright browsers
        run: npx playwright install --with-deps chromium
